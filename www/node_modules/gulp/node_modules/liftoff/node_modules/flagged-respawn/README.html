<!DOCTYPE html><html><head><!--css--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"><link rel="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,900' rel='stylesheet' type='text/css"><link rel="stylesheet" href="http://cdn.jsdelivr.net/qtip2/2.2.1/jquery.qtip.min.css"><link rel="stylesheet" href="/css/main.css"><!--JAVASCRIPT--><script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script><script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script><script type="text/javascript" src="js/imageMapResizer.min.js"></script><!--script(type="text/javascript" src="js/jquery.imagemapster.js")--><script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/jquery.qtip.min.js"></script><script type="text/javascript" src="js/main.js"></script></head><body><h1>flagged-respawn <a href="http://travis-ci.org/tkellen/node-flagged-respawn"><img src="https://secure.travis-ci.org/tkellen/node-flagged-respawn.png" alt="Build Status"></a></h1><blockquote>
<p>A tool for respawning node binaries when special flags are present.</p>
</blockquote>
<p><a href="https://nodei.co/npm/flagged-respawn/"><img src="https://nodei.co/npm/flagged-respawn.png" alt="NPM"></a></p>
<h2>What is it?</h2><p>Say you wrote a command line tool that runs arbitrary javascript (e.g. task runner, test framework, etc). For the sake of discussion, let&#39;s pretend it&#39;s a testing harness you&#39;ve named <code>testify</code>.</p>
<p>Everything is going splendidly until one day you decide to test some code that relies on a feature behind a v8 flag in node (<code>--harmony</code>, for example).  Without much thought, you run <code>testify --harmony spec tests.js</code>.</p>
<p>It doesn&#39;t work. After digging around for a bit, you realize this produces a <a href="http://nodejs.org/docs/latest/api/process.html#process_process_argv"><code>process.argv</code></a> of:</p>
<p><code>[&#39;node&#39;, &#39;/usr/local/bin/test&#39;, &#39;--harmony&#39;, &#39;spec&#39;, &#39;tests.js&#39;]</code></p>
<p>Crap. The <code>--harmony</code> flag is in the wrong place! It should be applied to the <strong>node</strong> command, not our binary. What we actually wanted was this:</p>
<p><code>[&#39;node&#39;, &#39;--harmony&#39;, &#39;/usr/local/bin/test&#39;, &#39;spec&#39;, &#39;tests.js&#39;]</code></p>
<p>Flagged-respawn fixes this problem and handles all the edge cases respawning creates, such as:</p>
<ul>
<li>Providing a method to determine if a respawn is needed.</li>
<li>Piping stderr/stdout from the child into the parent.</li>
<li>Making the parent process exit with the same code as the child.</li>
<li>If the child is killed, making the parent exit with the same signal.</li>
</ul>
<p>To see it in action, clone this repository and run <code>npm install</code> / <code>npm run respawn</code> / <code>npm run nospawn</code>.</p>
<h2>Sample Usage</h2><pre><code class="language-js">#!/usr/bin/env node

const flaggedRespawn = require(&#39;flagged-respawn&#39;);

// get a list of all possible v8 flags for the running version of node
const v8flags = require(&#39;v8flags&#39;).fetch();

flaggedRespawn(v8flags, process.argv, function (ready, child) {
  if (ready) {
    console.log(&#39;Running!&#39;);
    // your cli code here
  } else {
    console.log(&#39;Special flags found, respawning.&#39;);
  }
  if (process.pid !== child.pid) {
    console.log(&#39;Respawned to PID:&#39;, child.pid);
  }
});
</code></pre>
<h2>Release History</h2><ul>
<li>2014-09-12 - v0.3.1 - use <code>{ stdio: &#39;inherit&#39; }</code> for spawn to maintain colors</li>
<li>2014-09-11 - v0.3.0 - for real this time</li>
<li>2014-09-11 - v0.2.0 - cleanup</li>
<li>2014-09-04 - v0.1.1 - initial release</li>
</ul></body></html>